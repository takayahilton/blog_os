<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta http-equiv="X-Frame-Options" content="sameorigin">
  
  

  <title>
    Cross Compile Binutils &middot; Writing an OS in Rust
  </title>

  <link rel="canonical" href="http://os.phil-opp.com/cross-compile-binutils.html">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/syntax.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/images/favicon.ico">

  

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65296949-1', 'auto');
  ga('send', 'pageview');

</script>


  
  <script type="text/javascript">
    if (window.location.hostname == "phil-opp.github.io") {
      window.location.href = "http://os.phil-opp.com/";
    }
  </script>
</head>

<body>
<div class="container content">

<header class="masthead">
  <h3 class="masthead-title">
    <a href="/" title="Home">Writing an OS in Rust</a>
    <span class="navigation">
      <small><a href="/atom.xml"><img src="/images/feed-icon.png" alt="RSS"></a></small>
    </span>
    <small>Philipp&nbsp;Oppermann's&nbsp;blog</small>
  </h3>
</header>

<main>


<article class="post">
  <h1 class="post-title">Cross Compile Binutils</h1>

  

<p>The <a href="https://www.gnu.org/software/binutils/">GNU Binutils</a> are a collection of various binary tools such as <code>ld</code>, <code>as</code>, <code>objdump</code>, or <code>readelf</code>. These tools are platform-specific, so you need to compile them again if your host system and target system are different. In our case, we need <code>ld</code> and <code>objdump</code> for the x86_64 architecture.</p>

<h2 id="building-setup">Building Setup</h2>

<p>First, you need to download a current binutils version from <a href="ftp://sourceware.org/pub/binutils/snapshots">here</a> (the latest one is near the bottom). After extracting, you should have a folder named <code>binutils-2.X</code> where <code>X</code> is for example <code>25.1</code>. Now can create and switch to a new folder for building (recommended):</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>mkdir build-binutils
<span class="nb">cd</span> build-binutils
</code></pre></div>

<h2 id="configuration">Configuration</h2>

<p>We execute binutils&rsquo;s <code>configure</code> and pass a lot of arguments to it (replace the <code>X</code> with the version number):</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>../binutils-2.X/configure --target<span class="o">=</span>x86_64-elf --prefix<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/opt/cross&quot;</span> <span class="se">\</span>
    --disable-nls --disable-werror <span class="se">\</span>
    --disable-gdb --disable-libdecnumber --disable-readline --disable-sim
</code></pre></div>

<ul>
<li>The <code>target</code> argument specifies the the x86_64 target architecture.</li>
<li>The <code>prefix</code> argument selects the installation directory, you can change it if you like. But be careful that you do not overwrite your system&rsquo;s binutils.</li>
<li>The <code>disable-nls</code> flag disables native language support (so you&rsquo;ll get the same english error messages). It also reduces build dependencies.</li>
<li>The <code>disable-werror</code> turns all warnings into errors.</li>
<li>The last line disables features we don&rsquo;t need to reduce compile time.</li>
</ul>

<h2 id="building-it">Building it</h2>

<p>Now we can build and install it to the location supplied as <code>prefix</code> (it will take a while):</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>make
make install
</code></pre></div>

<p>Now you should have multiple <code>x86_64-elf-XXX</code> files in <code>$HOME/opt/cross/bin</code>.</p>

<h2 id="adding-it-to-the-path">Adding it to the PATH</h2>

<p>To use the tools from the command line easily, you should add the <code>bin</code> folder to your PATH:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/opt/cross/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
</code></pre></div>

<p>If you add this line to your e.g. <code>.bashrc</code>, the <code>x86_64-elf-XXX</code> commands are always available.</p>

</article>

</main>

<footer class="footer">
  <small>
    &copy;
    <time datetime="2016">2016</time>. All rights reserved.
    <a href="/contact.html">Contact</a>
  </small>
</footer>
</div>

</body>
</html>

